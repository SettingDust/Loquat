# 区域管理模组需求说明

# 概述

区域管理模组是一个对开发者指定的区域进行管理的模组。用户可对区域进行标记和批量管理，和对区域内的玩家或实体行为进行监听和限制。

项目暂定代号为Loquat。

# 整体说明

我们的最终目标是在Minecraft中实现一个动作类RPG游戏，其中的关卡需要对玩家的活动范围进行限制，并且需要在恰当的时间和位置生成敌人。因此，需要一个能够对区域进行批量管理的模组。

# 具体需求

## 项目

模组需要能够运行在1.19.2版本的Forge 或/和 Fabric上。为了方便移植，应当尽量剥离模组平台特有的代码。不可使用Architectury。（因为据我所知Architectury不支持Eclipse）

## 区域

 - 通过UUID识别
 - 各维度独立
 - 形状可为AABB、VoxelShape、柱体或不规则形状（暂时只支持AABB）
 - 除非必要，否则不向玩家本地同步区域信息
 - 分为黑名单和白名单模式，只对符合条件的玩家或实体生效
 - 不应存在区域完全重叠的情况
 - 可以设置多个字符串标记

### 创建和删除

通过命令创建和删除区域。命令格式如下：

    /loquat create box <x> <y> <z> <x> <y> <z>
    /loquat delete <uuid>

### 批量操作

用户可通过范围、距离、标记等条件将符合条件的区域加入到一个待操作列表中。命令格式参考实体选择器，如下：

    /loquat select [x=0,z=0,dx=3,dz=3,tag=foo,tag=bar,limit=10,distance=..5,type=boxes]
    /loquat unselect [x=0,z=0,dx=3,dz=3,tag=foo,tag=bar,limit=10,distance=..5,type=boxes]
    /loquat unselect all

可对待操作列表进行以下操作：

 - 删除。格式如下：

        /loquat delete selection

 - 标记。格式如下：

        /loquat tag add <tag>
        /loquat tag remove <tag>

操作后，待操作列表不清空。

### 客户端显示边界

通过命令显示附近区域边界。命令格式如下：

    /loquat outline

使用命令后将在显示与不显示之间切换。选中和未选中的区域边界颜色不同。

### 列出附近的区域

通过命令列出附近区域。命令格式如下：

    /loquat nearby

可对列出的结果进行以下操作：

 - 显示边界3秒
 - 在聊天栏中显示UUID、标记、模式等详细信息。用户可直接通过点击复制UUID
 - 将区域加入到待操作列表中

结果显示格式如下：

    - 中心位置 [高亮] [详情] [+]
    - 中心位置 [高亮] [详情] [+]
    - 中心位置 [高亮] [详情] [+]

## 行为监听

提供以下监听器，以供其他模组使用：

 - 玩家进入区域
 - 玩家离开区域（包括死亡）
 - 玩家在区域内死亡
 - 实体在区域内死亡

## 行为限制

可以设置限制区域内处于黑名单或白名单中的玩家或实体：

 - 离开区域（包括传送到其他维度）
 - 放置方块（包括放置液体等）

## 可生成实体的位置

### 烘焙

可为区域指定可生成实体的位置集合。烘焙方法为给定一个或多个VoxelShape，判断每个位置是否可以生成实体，将所有结果简化后存储到区域中。

由于实体的尺寸不一致，因此应当允许多个烘焙位置集同时存在。使用字符串作为键。

只需提供接口，不要求实现游戏内的操作方式。

### 随机选择位置

提供一个接口，随机选择一个合法且未被实体占用的位置。
